#! /bin/bash

mode=$1

echo Clearing modifiers.
xmodmap -e 'clear control'
xmodmap -e 'clear shift'
xmodmap -e 'clear mod1'
xmodmap -e 'clear mod4'

xmodmap

echo Resetting keyboard to defaults.
xmodmap - <<EOF
keycode  20 = minus underscore minus underscore minus underscore
keycode  23 = Tab ISO_Left_Tab Tab ISO_Left_Tab
keycode  59 = comma less comma less
keycode  60 = period greater period greater
keycode  94 = less greater less greater bar brokenbar bar
keycode  37 = Control_L NoSymbol Control_L
keycode 105 = Control_R NoSymbol Control_R
keycode 134 = Control_R NoSymbol Control_R
keycode  50 = Shift_L NoSymbol Shift_L
keycode  62 = Shift_R NoSymbol Shift_R
EOF

case $mode in
  chromebox)
    xmodmap -e 'keycode  134 = Control_R NoSymbol Control_R'
    ;;
esac

# xmodmap - <<EOF
# !keycode  23 = minus underscore minus underscore minus underscore
# !keycode  94 = Tab ISO_Left_Tab Tab ISO_Left_Tab
# !keycode  132 = Tab ISO_Left_Tab Tab ISO_Left_Tab
# !!keycode  134 = Shift_R NoSymbol Shift_R
# !keycode  50 = Control_L NoSymbol Control_L
# !keycode  62 = Control_R NoSymbol Control_R
# !keycode  37 = Shift_L NoSymbol Shift_L
# !keycode 105 = Shift_R NoSymbol Shift_R
# EOF

echo Re-enabling modifiers.
xmodmap -e 'add control = Control_L'
xmodmap -e 'add control = Control_R'
xmodmap -e 'add shift = Shift_L'
xmodmap -e 'add shift = Shift_R'
xmodmap -e 'add mod1 = Alt_L'
xmodmap -e 'add mod1 = Alt_R'
xmodmap -e 'add mod4 = Super_L'
xmodmap -e 'add mod4 = Super_R'


if [[ $DISPLAY == :20 ]]; then
  xmodmap -pke | egrep -w 'Control_[LR]|Shift_[LR]'
  xmodmap
  (DISPLAY=:0 exec "$0" &> /dev/null)
fi
